<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ViVi - Reproductor de Vídeo</title>
  <meta name="description" content="Reproductor de vídeo HTML5 con controles personalizados, HLS, lista de reproducción y seguridad reforzada.">

  <!-- CSP -->
  <meta http-equiv="Content-Security-Policy"
        content="
          default-src 'self';
          script-src 'self';
          style-src 'self' https://fonts.googleapis.com https://fonts.gstatic.com 'unsafe-inline';
          font-src 'self' https://fonts.gstatic.com;
          img-src 'self' data: https:;
          connect-src 'self';
          object-src 'none';
          base-uri 'self';
          frame-ancestors 'none';
          upgrade-insecure-requests;
          block-all-mixed-content;
        ">

  <!-- Preconnect & Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
          rel="stylesheet">
  </noscript>

  <!-- Bootstrap Icons -->
  <link rel="preload"
        href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
        as="style"
        onload="this.onload=null;this.rel='stylesheet'"
        integrity="sha384-+NVf5QHXf7jlk8S7aWbjiv5CCmT0heSaaCJ+heR8ZFNWmBtDLPH10y1XU3lBqaTy"
        crossorigin="anonymous">
  <noscript>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
          rel="stylesheet"
          integrity="sha384-+NVf5QHXf7jlk8S7aWbjiv5CCmT0heSaaCJ+heR8ZFNWmBtDLPH10y1XU3lBqaTy"
          crossorigin="anonymous">
  </noscript>

  <!-- Critical CSS -->
  <link rel="stylesheet" href="style.css">
  <style>
    html { scroll-behavior: smooth; }
    body {
      margin: 0;
      display: flex; align-items: center; justify-content: center;
      min-height: 100vh; background: #121212;
      overflow-x: hidden; font-family: 'Poppins', sans-serif;
    }
    .contenedor {
      width: 100%; max-width: 1200px; padding: 20px;
    }
  </style>

  <!-- Main CSS -->
  <link rel="preload" href="style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="style.css"></noscript>
</head>

<body>
  <main class="contenedor" role="main">
    <!-- Reproductor -->
    <section class="reproductor-video" id="reproductor">
      <video id="video" playsinline preload="metadata" poster="img/poster.jpg" aria-label="Reproductor de vídeo">
        <source src="" type="video/mp4">
        <track id="track-subtitulos" kind="subtitles" src="" srclang="es" label="Español" default>
        Tu navegador no soporta vídeo.
      </video>

      <div class="menu-reproductor" id="menu-reproductor" role="group" aria-label="Controles del reproductor">
        <div class="info-video">
          <h1 id="titulo-video">Título del vídeo</h1>
          <p id="autor-video">Autor / Tamaño</p>
        </div>
        <div class="barra-progreso" aria-label="Progreso del vídeo">
          <div class="tiempo-actual" id="tiempo-actual">0:00</div>
          <input id="progreso" class="slider-progreso" type="range" min="0" max="100" step="0.1" value="0" aria-hidden="true">
          <div class="tiempo-total" id="tiempo-total">0:00</div>
        </div>
        <div class="controles" role="toolbar" aria-label="Controles de reproducción">
          <button id="btn-retroceder" class="boton-control" aria-label="Retroceder 10s">
            <i class="bi bi-rewind-fill"></i>
          </button>
          <button id="btn-reproducir" class="boton-control principal" aria-label="Reproducir/Pausar">
            <i id="icono-reproducir" class="bi bi-play-fill"></i>
          </button>
          <button id="btn-avanzar" class="boton-control" aria-label="Avanzar 10s">
            <i class="bi bi-fast-forward-fill"></i>
          </button>
          <div class="control-volumen" role="group" aria-label="Volumen">
            <button id="btn-volumen" class="boton-control" aria-label="Silenciar/Restaurar">
              <i id="icono-volumen" class="bi bi-volume-up-fill"></i>
            </button>
            <input id="volumen" type="range" min="0" max="1" step="0.05" value="0.7"
                   role="slider" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0.7" aria-label="Volumen">
          </div>
          <button id="btn-config" class="boton-control" aria-label="Configuración">
            <i class="bi bi-gear-fill"></i>
          </button>
          <button id="btn-subtitulos" class="boton-control" aria-label="Toggle subtítulos">
            <i id="icono-subtitulos" class="bi bi-badge-cc"></i>
          </button>
          <button id="btn-pantalla-completa" class="boton-control" aria-label="Pantalla completa">
            <i class="bi bi-fullscreen"></i>
          </button>
        </div>
      </div>

      <!-- Configuración -->
      <div class="menu-configuracion" id="menu-configuracion" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="config-header">
          <h3>Configuración</h3>
          <button id="cerrar-config" class="btn-cerrar" aria-label="Cerrar">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>
        <div class="config-opciones">
          <div class="opcion">
            <label for="resolucion">Resolución</label>
            <select id="resolucion" aria-label="Resolución"></select>
          </div>
          <div class="opcion">
            <label for="velocidad">Velocidad</label>
            <select id="velocidad" aria-label="Velocidad">
              <option value="0.5">0.5×</option>
              <option value="0.75">0.75×</option>
              <option value="1" selected>1×</option>
              <option value="1.25">1.25×</option>
              <option value="1.5">1.5×</option>
              <option value="2">2×</option>
            </select>
          </div>
        </div>
      </div>
    </section>

    <!-- Gestión de vídeos -->
    <section class="gestion-videos" aria-label="Gestión de vídeos">
      <div class="gestion-botones">
        <label for="subir-video" class="boton-gestion">
          <i class="bi bi-upload"></i><span>Subir Vídeo</span>
        </label>
        <input id="subir-video" type="file" accept="video/mp4,video/webm,video/ogg,.m3u8" multiple hidden aria-label="Subir vídeos">

        <button id="limpiar-videos" class="boton-gestion" aria-label="Limpiar lista">
          <i class="bi bi-trash"></i><span>Limpiar Lista</span>
        </button>

        <label for="input-subtitulos" class="boton-gestion">
          <i class="bi bi-card-text"></i><span>Añadir Subtítulos</span>
        </label>
        <input id="input-subtitulos" type="file" accept=".vtt,.srt" hidden aria-label="Subir subtítulos">
      </div>
      <div class="lista-videos-container">
        <h3>Lista de Vídeos <span id="contador-videos">(0)</span></h3>
        <ul id="lista-videos" class="lista-videos">
          <li class="video-vacio">No hay vídeos en la lista</li>
        </ul>
      </div>
    </section>
  </main>

  <!-- Alertas y diálogos -->
  <div id="alerta-tamaño" class="alerta" role="alert" aria-hidden="true">
    <div class="alerta-contenido">
      <i class="bi bi-exclamation-triangle-fill"></i>
      <p>El archivo excede el límite de 10 GB.</p>
      <button id="cerrar-alerta" class="btn-cancelar">Entendido</button>
    </div>
  </div>
  <div id="dialogo-confirmacion" class="dialogo-confirmacion" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="dialogo-contenido">
      <h3>¿Estás seguro?</h3>
      <p id="texto-confirmacion">¿Deseas eliminar este vídeo?</p>
      <div class="dialogo-botones">
        <button id="confirmar-si" class="btn-confirmar">Sí</button>
        <button id="confirmar-no" class="btn-cancelar">No</button>
      </div>
    </div>
  </div>

  <noscript>
    <p style="color:#fff; text-align:center;">
      JavaScript es necesario para el reproductor.
    </p>
  </noscript>
  <script defer src="script.js"></script>
  <script src="script.js" defer></script>
</body>
</html>
